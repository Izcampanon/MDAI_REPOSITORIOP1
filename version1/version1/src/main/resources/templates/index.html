<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Página de Bienvenida</title>
    <link rel="stylesheet" th:href="@{/styles/index.css}" />
</head>

<body>
<header class="site-header">
    <div class="container header-inner">
        <div class="brand">ENTRADAXPRESS</div>
        <nav class="main-nav">
            <a href="/" class="nav-link">Inicio</a>
            <a href="/login" class="nav-link">Login</a>
            <a href="/mis-entradas" class="nav-link">Mis entradas</a>
            <a href="/saldo" class="nav-link">Saldo</a>
            <a href="/comprar" class="nav-link cta">Comprar entrada</a>
        </nav>
    </div>
</header>

<main class="container main-content">
    <section class="hero">
        <h1>Bienvenido a EntradasApp</h1>
        <p>Compra y gestiona tus entradas de forma fácil y rápida.</p>
        <div class="hero-actions">
            <a class="btn" href="/comprar">Comprar entrada</a>
            <a class="btn ghost" href="/mis-entradas">Ver mis entradas</a>
            <!-- Nuevo botón para recomendaciones -->
            <button id="btnRecomendar" class="btn" type="button">Recomendaciones</button>
        </div>
    </section>

    <section class="features">
        <div class="feature">
            <h3>Acceso rápido</h3>
            <p>Inicia sesión para ver tus compras y datos personales.</p>
        </div>
        <div class="feature">
            <h3>Entradas disponibles</h3>
            <p>Navega entre eventos y compra la entrada que más te guste.</p>
        </div>
        <div class="feature">
            <h3>Gestión sencilla</h3>
            <p>Consulta y descarga tus entradas desde tu perfil.</p>
        </div>
    </section>

    <!-- Panel de recomendaciones / chat -->
    <section id="recomendacionPanel" class="reco-panel" style="display:none; margin-top:20px;">
        <h2>Recomendaciones</h2>
        <div>
            <label for="prefs">Dime tus preferencias (género, artista, palabra clave):</label>
            <input id="prefs" type="text" placeholder="Ej. rock, pop, jazz..." style="width:60%; padding:6px" />
            <button id="sendPrefs" class="btn" type="button">Pedir recomendaciones</button>
            <button id="closeReco" class="btn ghost" type="button">Cerrar</button>
        </div>
        <div id="recoResult" style="white-space:pre-wrap; margin-top:12px; padding:12px; border:1px solid #e5e7eb; background:#fff;"></div>
    </section>

</main>

<footer class="site-footer">
    <div class="container">
        <p>&copy; 2025 EntradasApp. Todos los derechos reservados.</p>
    </div>
</footer>

<script>
    // Manejo básico del panel y llamada AJAX (fetch)
    document.getElementById('btnRecomendar').addEventListener('click', function() {
        document.getElementById('recomendacionPanel').style.display = 'block';
        document.getElementById('recoResult').textContent = 'Cargando...';
    });

    document.getElementById('closeReco').addEventListener('click', function() {
        document.getElementById('recomendacionPanel').style.display = 'none';
    });

    document.getElementById('sendPrefs').addEventListener('click', function() {
        const prefs = document.getElementById('prefs').value || '';
        const resultDiv = document.getElementById('recoResult');
        resultDiv.textContent = 'Solicitando recomendaciones...';

        fetch('/recomendaciones', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ preferencias: prefs })
        })
        .then(resp => {
            if (!resp.ok) throw new Error('Error en la petición: ' + resp.status);
            return resp.json();
        })
        .then(data => {
            resultDiv.textContent = data.recomendaciones || 'No hay recomendaciones.';
        })
        .catch(err => {
            resultDiv.textContent = 'Se produjo un error al obtener las recomendaciones: ' + err.message;
        });
    });
</script>

</body>
</html>